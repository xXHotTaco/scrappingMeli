<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscador de Llantas Goodyear</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f8fafc;
      color: #222;
      padding: 32px 0;
    }
    h2 {
      margin-bottom: 0.7em;
      text-align: center;
    }
    .buscador {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 28px;
    }
    input[type="text"] {
      font-size: 1rem;
      padding: 8px;
      width: 300px;
      border: 1px solid #ccd;
      border-radius: 6px;
      outline: none;
      transition: border 0.2s;
    }
    input[type="text"]:focus {
      border-color: #2c82e8;
    }
    button {
      background: #2563eb;
      color: #fff;
      border-radius: 6px;
      border: none;
      padding: 9px 22px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #1e40af;
    }
    #resultados {
      display: flex;
      justify-content: center;
      margin-top: 12px;
    }
    table {
      background: #fff;
      border-collapse: collapse;
      min-width: 700px;
      box-shadow: 0 3px 20px #ccd4e1;
      border-radius: 12px;
      overflow: hidden;
    }
    th, td {
      padding: 14px 10px;
      border-bottom: 1px solid #eef2f6;
      text-align: center;
    }
    th {
      background: #f1f5fd;
      font-weight: 600;
    }
    tr:last-child td {
      border-bottom: none;
    }
    tr:hover {
      background: #e8f0fe;
    }
    img {
      max-width: 72px;
      border-radius: 8px;
      box-shadow: 0 1px 8px #cad3e1;
    }
    .sin-imagen {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 72px;
      color: #aaa;
      font-size: 2em;
    }
    .error, .mensaje {
      text-align: center;
      color: #d7263d;
      font-weight: 500;
      margin-bottom: 24px;
    }
  </style>
</head>
<body>
  <h2>Busca llantas por modelo</h2>
  <div class="buscador">
    <input type="text" id="query" placeholder="Ejemplo: 185/65/R15 Goodyear Assurance 88T" />
    <button onclick="buscar()">Buscar</button>
  </div>
  <div id="resultados"></div>

  <script>
    function buscar() {
      const q = document.getElementById('query').value.trim();
      if (!q) {
        document.getElementById('resultados').innerHTML = "<div class='mensaje'>Introduce un modelo de llanta y haz click en buscar.</div>";
        return;
      }
      document.getElementById('resultados').innerHTML = "<div class='mensaje'>Buscando...</div>";
      fetch('http://127.0.0.1:5000/api/llantas?q=' + encodeURIComponent(q))
        .then(r => r.json())
        .then(data => {
          if (!data.length) {
            document.getElementById('resultados').innerHTML = "<div class='mensaje'>No se encontraron resultados.</div>";
            return;
          }
          let html = `<table><thead><tr><th>Miniatura</th><th>Título</th><th>Precio</th><th>Enlace</th></tr></thead><tbody>`;
          data.forEach(p => {
            // Detecta el pixel transparente base64 (Sin imagen)
            let esPixelVacio = p.thumbnail && p.thumbnail.startsWith('data:image');
            let thumb = (!p.thumbnail || esPixelVacio)
              ? `<span class="sin-imagen" title="Sin imagen">
                   <svg width="32" height="32" fill="none" viewBox="0 0 24 24">
                     <rect width="24" height="24" fill="#f1f1f1"/>
                     <path stroke="#aaa" stroke-width="2" d="M4 19V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z"/>
                     <path stroke="#aaa" stroke-width="1.5" d="M3 17.5L9.5 11l4 4 5.5-6.5"/>
                   </svg>
                 </span>`
              : `<img src="${p.thumbnail}" alt="miniatura">`;
            html += `<tr>
              <td>${thumb}</td>
              <td>${p.titulo || '(Sin título)'}</td>
              <td>$${p.precio}</td>
              <td><a href="${p.url}" target="_blank">Ver producto</a></td>
            </tr>`;
          });
          html += `</tbody></table>`;
          document.getElementById('resultados').innerHTML = html;
        }).catch(error => {
          document.getElementById('resultados').innerHTML = `<div class="error">Error cargando resultados: ${error}</div>`;
        });
    }
  </script>
</body>
</html>
