<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscador de Llantas Goodyear</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f9fbfc;
      color: #222;
      padding: 32px 0;
    }
    h2 {
      margin-bottom: 0.7em;
      text-align: center;
      font-size: 2em;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .buscador {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 14px;
    }
    input[type="text"] {
      font-size: 1.1rem;
      padding: 10px;
      width: 280px;
      border: 1px solid #bbe;
      border-radius: 8px;
      outline: none;
      transition: border 0.2s;
      background: #fff;
    }
    input[type="text"]:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 2px #e0eaff;
    }
    button {
      background: #2563eb;
      color: #fff;
      border-radius: 8px;
      border: none;
      padding: 10px 36px;
      font-size: 1.1rem;
      font-weight: 500;
      box-shadow: 0 2px 12px #dde4f1;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.16s;
    }
    button:hover {
      background: #1749b1;
      box-shadow: 0 3px 18px #cddaf5;
    }
    #resultados {
      display: flex;
      justify-content: center;
      margin-top: 16px;
    }
    .resultados-contenedor {
      width: 100%;
      max-width: 900px;
      padding: 18px 18px 10px 18px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 6px 32px #e0e7ef;
    }
    table {
      width: 100%;
      background: #fff;
      border-collapse: collapse;
      box-shadow: 0 2px 14px #dde4f7;
      border-radius: 12px;
      overflow: hidden;
      margin: 0 auto;
    }
    th, td {
      padding: 14px 10px;
      border-bottom: 1px solid #ececec;
      text-align: center;
      font-size: 1rem;
    }
    th {
      background: #f1f5fd;
      font-weight: 600;
      font-size: 1.1em;
    }
    tr:last-child td { border-bottom: none; }
    tr:hover { background: #f6f9ff; }
    img {
      max-width: 72px;
      border-radius: 8px;
      box-shadow: 0 1px 8px #e2e7f4;
      background: #fafbfc;
    }
    .sin-imagen {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 72px;
      color: #bbb;
      font-size: 1.5em;
      padding: 0 16px;
    }
    .error, .mensaje {
      text-align: center;
      font-weight: 500;
      margin-bottom: 20px;
      letter-spacing: 0.3px;
    }
    .error { color: #d7263d; }
    .mensaje { color: #206db6; }
    .modelo-buscado {
      text-align: left;
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #222;
      font-weight: 450;
    }
    .modelo-buscado b {
      color: #1749b1;
      background: #e9f1fb;
      padding: 2px 8px;
      border-radius: 5px;
      letter-spacing:1px;
      font-size: 1.07em;
    }
    @media (max-width: 900px) {
      .resultados-contenedor { max-width: 99vw; }
      table{ font-size:0.95em;}
      th,td{ padding:8px 4px;}
    }
    @media (max-width: 600px) {
      .resultados-contenedor{padding:6px 0;}
      table{ font-size:0.93em;}
    }
  </style>
</head>
<body>
  <h2>Busca llantas por SKU</h2>
  <div class="buscador">
    <input type="text" id="query" placeholder="Ejemplo: PIR2323000" />
    <button onclick="buscar()">Buscar</button>
  </div>
  <div id="resultados"></div>

  <script>
    function buscar() {
      const q = document.getElementById('query').value.trim();
      if (!q) {
        document.getElementById('resultados').innerHTML = "<div class='mensaje resultados-contenedor'>Introduce un SKU y haz click en buscar.</div>";
        return;
      }
      document.getElementById('resultados').innerHTML = "<div class='mensaje resultados-contenedor'>Buscando...</div>";
      fetch('http://127.0.0.1:5000/api/llantas?q=' + encodeURIComponent(q))
        .then(r => r.json())
        .then(data => {
          let resultadosDiv = document.getElementById('resultados');
          let html = `<div class="resultados-contenedor">`;
          if (!data.productos_meli || !Array.isArray(data.productos_meli) || data.productos_meli.length === 0) {
            let mensaje = data.error || "No se encontraron resultados.";
            html += `<div class='mensaje'>${mensaje}</div>`;
            resultadosDiv.innerHTML = html + "</div>";
            return;
          }
          html += `<div class="modelo-buscado">Modelo buscado: <b>${data.bodyModelo || ''}</b></div>`;
          html += `<table><thead><tr><th>Miniatura</th><th>Título</th><th>Precio</th><th>Enlace</th></tr></thead><tbody>`;
          data.productos_meli.forEach(p => {
            let esPixelVacio = p.thumbnail && p.thumbnail.startsWith('data:image');
            let thumb = (!p.thumbnail || esPixelVacio)
              ? `<span class="sin-imagen" title="Sin imagen">
                  <svg width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <rect width="24" height="24" fill="#f1f1f1"/>
                    <path stroke="#bbb" stroke-width="2" d="M4 19V5a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2Z"/>
                    <path stroke="#bbb" stroke-width="1.5" d="M3 17.5L9.5 11l4 4 5.5-6.5"/>
                  </svg>
                </span>`
              : `<img src="${p.thumbnail}" alt="miniatura">`;
            html += `<tr>
              <td>${thumb}</td>
              <td>${p.titulo || '(Sin título)'}</td>
              <td>$${p.precio}</td>
              <td><a href="${p.url}" target="_blank">Ver producto</a></td>
            </tr>`;
          });
          html += `</tbody></table></div>`;
          resultadosDiv.innerHTML = html;
        }).catch(error => {
          document.getElementById('resultados').innerHTML = `<div class="error resultados-contenedor">Error cargando resultados: ${error}</div>`;
        });
    }
  </script>
</body>
</html>
